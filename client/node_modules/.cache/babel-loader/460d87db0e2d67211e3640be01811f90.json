{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Paul\\\\Desktop\\\\Projects\\\\react\\\\contact-manager\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Paul\\\\Desktop\\\\Projects\\\\react\\\\contact-manager\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\Paul\\\\Desktop\\\\Projects\\\\react\\\\contact-manager\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useReducer}from'react';import axios from'axios';import AuthContext from'./AuthContext';import AuthReducer from'./AuthReducer';import setAuthToken from'../../utils/setAuthToken';import{REGISTER_SUCCESS,REGISTER_FAIL,USER_LOADED,AUTH_ERROR,LOGIN_SUCCESS,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS}from'../types';var AuthState=function AuthState(props){var initialState={token:localStorage.getItem('token'),isAuthenticated:null,user:null,loading:true,error:null};var _useReducer=useReducer(AuthReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];//Load User\nvar loadUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0://load token into global headers. Private route\nsetAuthToken(localStorage.token);_context.prev=1;_context.next=4;return axios.get('http://localhost:7000/api/auth');case 4:res=_context.sent;dispatch({type:USER_LOADED,payload:res.data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:AUTH_ERROR});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function loadUser(){return _ref.apply(this,arguments);};}();//Register User\nvar registerUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(formData){var config,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:config={headers:{'Content-Type':'application/json'}};_context2.prev=1;_context2.next=4;return axios.post('http://localhost:7000/api/users',formData,config);case 4:res=_context2.sent;dispatch({type:REGISTER_SUCCESS,payload:res.data});loadUser();_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);dispatch({type:REGISTER_FAIL,payload:_context2.t0.response.data.msg});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9]]);}));return function registerUser(_x){return _ref2.apply(this,arguments);};}();//Login User\nvar loginUser=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(formData){var config,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:config={headers:{'Content-Type':'application/json'}};_context3.prev=1;_context3.next=4;return axios.post('http://localhost:7000/api/auth',formData,config);case 4:res=_context3.sent;dispatch({type:LOGIN_SUCCESS,payload:res.data});loadUser();_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data.msg});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[1,9]]);}));return function loginUser(_x2){return _ref3.apply(this,arguments);};}();//Logout User\nvar logout=function logout(){return dispatch({type:LOGOUT});};//Clear Errors\nvar clearErrors=function clearErrors(){return dispatch({type:CLEAR_ERRORS});};return React.createElement(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,loading:state.loading,user:state.user,error:state.error,registerUser:registerUser,clearErrors:clearErrors,loginUser:loginUser,loadUser:loadUser,logout:logout}},props.children);};export default AuthState;","map":{"version":3,"sources":["C:/Users/Paul/Desktop/Projects/react/contact-manager/client/src/context/auth/AuthState.js"],"names":["React","useReducer","axios","AuthContext","AuthReducer","setAuthToken","REGISTER_SUCCESS","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","AuthState","props","initialState","token","localStorage","getItem","isAuthenticated","user","loading","error","state","dispatch","loadUser","get","res","type","payload","data","registerUser","formData","config","headers","post","response","msg","loginUser","logout","clearErrors","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from 'react';\r\nimport axios from 'axios';\r\nimport AuthContext from './AuthContext';\r\nimport AuthReducer from './AuthReducer';\r\nimport setAuthToken from '../../utils/setAuthToken';\r\nimport {\r\n    REGISTER_SUCCESS,\r\n    REGISTER_FAIL,\r\n    USER_LOADED,\r\n    AUTH_ERROR,\r\n    LOGIN_SUCCESS,\r\n    LOGIN_FAIL,\r\n    LOGOUT,\r\n    CLEAR_ERRORS\r\n} from '../types';\r\n\r\nconst AuthState = props => {\r\n    const initialState = {\r\n        token: localStorage.getItem('token'),\r\n        isAuthenticated: null,\r\n        user: null,\r\n        loading: true,\r\n        error: null\r\n    }\r\n\r\n    const [state, dispatch] = useReducer(AuthReducer, initialState);\r\n\r\n    //Load User\r\n    const loadUser = async() => {\r\n        //load token into global headers. Private route\r\n        setAuthToken(localStorage.token);\r\n\r\n        try {\r\n            const res = await axios.get('http://localhost:7000/api/auth');\r\n\r\n            dispatch({\r\n                type: USER_LOADED,\r\n                payload: res.data\r\n            });\r\n\r\n        } catch (err) {\r\n            dispatch({\r\n                type: AUTH_ERROR\r\n            });\r\n        }\r\n    };\r\n\r\n    //Register User\r\n    const registerUser = async(formData) => {\r\n        const config = {\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            }\r\n        };\r\n\r\n        try {\r\n            const res = await axios.post('http://localhost:7000/api/users', formData, config);\r\n\r\n            dispatch({\r\n                type: REGISTER_SUCCESS,\r\n                payload: res.data\r\n            });\r\n\r\n            loadUser();\r\n\r\n        } catch (err) {\r\n            dispatch({\r\n                type: REGISTER_FAIL,\r\n                payload: err.response.data.msg\r\n            })\r\n        }\r\n    }\r\n\r\n    //Login User\r\n    const loginUser = async(formData) => {\r\n        const config = {\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            }\r\n        };\r\n\r\n        try {\r\n            const res = await axios.post('http://localhost:7000/api/auth', formData, config);\r\n\r\n            dispatch({\r\n                type: LOGIN_SUCCESS,\r\n                payload: res.data\r\n            });\r\n\r\n            loadUser();\r\n\r\n        } catch (err) {\r\n            dispatch({\r\n                type: LOGIN_FAIL,\r\n                payload: err.response.data.msg\r\n            })\r\n        }\r\n    }\r\n    //Logout User\r\n    const logout = () => dispatch({ type: LOGOUT });\r\n\r\n    //Clear Errors\r\n    const clearErrors = () => dispatch({ type: CLEAR_ERRORS });\r\n\r\n    return (\r\n        <AuthContext.Provider\r\n            value={{\r\n                token: state.token,\r\n                isAuthenticated: state.isAuthenticated,\r\n                loading: state.loading,\r\n                user: state.user,\r\n                error: state.error,\r\n                registerUser,\r\n                clearErrors,\r\n                loginUser,\r\n                loadUser,\r\n                logout\r\n            }}\r\n        >\r\n            { props.children }\r\n        </AuthContext.Provider>\r\n    )\r\n}\r\n\r\nexport default AuthState;"]},"metadata":{},"sourceType":"module"}